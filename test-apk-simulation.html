<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APKç’°å¢ƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ - ãƒ©ãƒŸã‚ªãƒšãƒ»ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .simulation-banner {
            background: #e74c3c;
            color: white;
            text-align: center;
            padding: 10px;
            font-weight: bold;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 9999;
        }
        body { margin-top: 40px; }
        .simulation-controls {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 9998;
        }
    </style>
</head>
<body>
    <div class="simulation-banner">
        ğŸ­ APKç’°å¢ƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ - ãƒãƒ³ãƒ‰ãƒ«æ¸ˆã¿Capacitorãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’æ¨¡æ“¬
    </div>
    
    <div class="simulation-controls">
        ğŸ“± ä»®æƒ³APKç’°å¢ƒ<br>
        ğŸ”§ ãƒãƒ³ãƒ‰ãƒ«æ–¹å¼ãƒ†ã‚¹ãƒˆä¸­
    </div>

    <!-- APKç’°å¢ƒã®Capacitorã‚’ãƒ¢ãƒƒã‚¯ -->
    <script>
        console.log('ğŸ­ APKç’°å¢ƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹');
        
        // APKç’°å¢ƒã®Capacitorã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å®Œå…¨ã«ãƒ¢ãƒƒã‚¯
        window.Capacitor = {
            // ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æ¤œå‡ºï¼ˆAPKç’°å¢ƒã¨ã—ã¦è¿”ã™ï¼‰
            isNativePlatform: () => {
                console.log('ğŸ­ isNativePlatform() called - returning true (APK simulation)');
                return true;
            },
            
            // APKã®ãƒãƒ³ãƒ‰ãƒ«æ¸ˆã¿ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ãƒ¢ãƒƒã‚¯
            Plugins: {
                Preferences: {
                    async get({ key }) {
                        console.log('ğŸ­ Mock Preferences.get:', key);
                        const value = localStorage.getItem(`capacitor_pref_${key}`);
                        return { value };
                    },
                    async set({ key, value }) {
                        console.log('ğŸ­ Mock Preferences.set:', key, '=', value?.substring(0, 100) + '...');
                        localStorage.setItem(`capacitor_pref_${key}`, value);
                    },
                    async remove({ key }) {
                        console.log('ğŸ­ Mock Preferences.remove:', key);
                        localStorage.removeItem(`capacitor_pref_${key}`);
                    },
                    async keys() {
                        const keys = Object.keys(localStorage).filter(k => k.startsWith('capacitor_pref_'));
                        return { keys: keys.map(k => k.replace('capacitor_pref_', '')) };
                    }
                },
                
                Filesystem: {
                    async writeFile({ path, data, directory, encoding }) {
                        console.log('ğŸ­ Mock Filesystem.writeFile:', { path, directory, encoding, dataSize: data.length });
                        
                        // LocalStorageã«ä¿å­˜ï¼ˆå®Ÿéš›ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’ãƒ¢ãƒƒã‚¯ï¼‰
                        const fullPath = `${directory}/${path}`;
                        localStorage.setItem(`capacitor_file_${fullPath}`, data);
                        
                        // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹
                        return { uri: `file:///android_asset/Documents/${path}` };
                    },
                    
                    async readFile({ path, directory, encoding }) {
                        console.log('ğŸ­ Mock Filesystem.readFile:', { path, directory, encoding });
                        const fullPath = `${directory}/${path}`;
                        const data = localStorage.getItem(`capacitor_file_${fullPath}`);
                        if (data === null) {
                            throw new Error(`File not found: ${fullPath}`);
                        }
                        return { data };
                    },
                    
                    async mkdir({ path, directory, recursive }) {
                        console.log('ğŸ­ Mock Filesystem.mkdir:', { path, directory, recursive });
                        // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆã‚’ãƒ¢ãƒƒã‚¯ï¼ˆå¸¸ã«æˆåŠŸï¼‰
                        return {};
                    },
                    
                    async getUri({ path, directory }) {
                        console.log('ğŸ­ Mock Filesystem.getUri:', { path, directory });
                        return { uri: `file:///android_asset/${directory}/${path}` };
                    },
                    
                    async checkPermissions() {
                        console.log('ğŸ­ Mock Filesystem.checkPermissions');
                        return { publicStorage: 'granted' };
                    },
                    
                    async requestPermissions() {
                        console.log('ğŸ­ Mock Filesystem.requestPermissions');
                        return { publicStorage: 'granted' };
                    }
                }
            },
            
            // Directoryå®šæ•°
            Directory: {
                Documents: 'DOCUMENTS',
                Data: 'DATA',
                Cache: 'CACHE',
                External: 'EXTERNAL',
                ExternalStorage: 'EXTERNAL_STORAGE'
            },
            
            // Encodingå®šæ•°
            Encoding: {
                UTF8: 'utf8',
                ASCII: 'ascii',
                UTF16: 'utf16'
            }
        };
        
        console.log('âœ… APKç’°å¢ƒã®Capacitorãƒ¢ãƒƒã‚¯å®Œäº†');
        console.log('ğŸ” Capacitorã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ:', window.Capacitor);
    </script>
    
    <!-- å…ƒã®ã‚¢ãƒ—ãƒªã‚’ãƒ­ãƒ¼ãƒ‰ -->
    <div class="app-container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header class="app-header">
            <div class="header-title">
                <h1>ğŸ­ ãƒ©ãƒŸã‚ªãƒšãƒ»ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ (APK ãƒ†ã‚¹ãƒˆ)</h1>
                <div class="current-time" id="currentTime"></div>
            </div>
            <div class="header-actions">
                <button class="header-btn" onclick="dashboard.showSettings()">âš™ï¸ è¨­å®š</button>
            </div>
        </header>

        <!-- ãƒ¡ã‚¤ãƒ³çµ±åˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
        <main id="main-content" class="main-dashboard">
            
            <!-- APKãƒ†ã‚¹ãƒˆå°‚ç”¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
            <section class="card" style="background: #f8f9fa; border: 2px dashed #6c757d;">
                <h3>ğŸ­ APKä»®æƒ³ãƒ†ã‚¹ãƒˆå°‚ç”¨</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                    <button class="btn btn-primary" onclick="testCapacitorDetection()">ğŸ“± Capacitoræ¤œå‡ºãƒ†ã‚¹ãƒˆ</button>
                    <button class="btn btn-primary" onclick="testDataSave()">ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãƒ†ã‚¹ãƒˆ</button>
                    <button class="btn btn-primary" onclick="testBackupFunction()">ğŸ“¤ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ†ã‚¹ãƒˆ</button>
                    <button class="btn btn-primary" onclick="testCsvExport()">ğŸ“‹ CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ†ã‚¹ãƒˆ</button>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <button class="btn btn-secondary" onclick="showStoredFiles()">ğŸ“ ä¿å­˜ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª</button>
                    <button class="btn btn-secondary" onclick="clearSimulationData()">ğŸ—‘ï¸ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢</button>
                </div>
            </section>
            
            <!-- æ™‚é–“è¡¨ç¤ºã‚¨ãƒªã‚¢ï¼ˆ3ã‚«ãƒ©ãƒ æ§‹æˆï¼‰ -->
            <section class="time-display-grid card">
                <div class="time-column">
                    <div class="time-label">é–‹å§‹æ™‚åˆ»</div>
                    <div class="time-value editable" id="workStartTime" onclick="dashboard.editStartTime()">--:--</div>
                    <div class="time-action">æ‰‹å‹•è¨­å®šå¯</div>
                </div>
                
                <div class="time-column primary">
                    <div class="time-label">æœ€çµ‚çµ‚äº†äºˆå®š</div>
                    <div class="time-value" id="finalFinishTime">--:--</div>
                    <div class="time-status" id="finishStatus">æ¥­å‹™é–‹å§‹å‰</div>
                </div>
                
                <div class="time-column">
                    <div class="time-label">æœ¬æ—¥ã®ç›®æ¨™</div>
                    <div class="time-value editable" id="targetEndTime" onclick="dashboard.editTargetTime()">17:00</div>
                    <div class="time-action">å®šæ™‚/æ®‹æ¥­åˆ‡æ›¿</div>
                </div>
            </section>

            <!-- æ“ä½œã‚¨ãƒªã‚¢ -->
            <section class="operation-area">
                
                <!-- æ™‚é–“èª¿æ•´ãƒœã‚¿ãƒ³ -->
                <div class="time-controls">
                    <h4>æ™‚é–“ç®¡ç†</h4>
                    <div class="time-btn-grid">
                        <button class="time-btn" onclick="dashboard.startWork()">æ¥­å‹™é–‹å§‹</button>
                        <button class="time-btn" onclick="dashboard.addLunchBreak()">æ˜¼ä¼‘ã¿è¿½åŠ </button>
                        <button class="time-btn" onclick="dashboard.addManualTime()">æ‰‹å‹•ã§æ™‚é–“è¿½åŠ </button>
                        <button class="time-btn" onclick="dashboard.addExchangeTime()">äº¤æ›æ™‚é–“è¿½åŠ </button>
                    </div>
                </div>

            </section>

            <!-- ã‚¸ãƒ§ãƒ–ãƒªã‚¹ãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <section class="job-list-area">
                <div class="job-list-header">
                    <h3>ã‚¸ãƒ§ãƒ–ãƒªã‚¹ãƒˆ</h3>
                    <button class="report-btn" onclick="dashboard.showReport()">ğŸ“Š æœ¬æ—¥ã®ãƒ¬ãƒãƒ¼ãƒˆ</button>
                </div>
                
                <div id="jobListContainer" class="job-list-container">
                    <div class="empty-state">
                        APKä»®æƒ³ãƒ†ã‚¹ãƒˆç’°å¢ƒ<br>
                        ã¾ãšã¯ä¸Šã®ã€ŒAPKä»®æƒ³ãƒ†ã‚¹ãƒˆå°‚ç”¨ã€ãƒœã‚¿ãƒ³ã§å‹•ä½œç¢ºèªã—ã¦ãã ã•ã„
                    </div>
                </div>
            </section>

        </main>

        <!-- è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆå…ƒã®HTMLã‹ã‚‰è¤‡è£½ï¼‰ -->
        <div id="settingsModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>âš™ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š (APKãƒ†ã‚¹ãƒˆ)</h3>
                    <button class="modal-close" onclick="dashboard.hideSettings()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="settings-section">
                        <h4>ãƒ‡ãƒ¼ã‚¿ç®¡ç† (APKãƒ†ã‚¹ãƒˆ)</h4>
                        <div class="form-group">
                            <button class="btn btn-primary" id="backup-data-btn" onclick="dashboard.backupData()">ğŸ“¤ é€²æ—ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— (APKãƒ†ã‚¹ãƒˆ)</button>
                            <button class="btn btn-secondary" id="restore-data-btn" onclick="dashboard.triggerRestore()">ğŸ“¥ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ</button>
                            <input type="file" id="restore-file-input" accept=".json" style="display: none;" onchange="dashboard.restoreData(event)">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ãƒ¬ãƒãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div id="reportModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>ğŸ“Š æœ¬æ—¥ã®ä½œæ¥­ãƒ¬ãƒãƒ¼ãƒˆ (APKãƒ†ã‚¹ãƒˆ)</h3>
                    <button class="modal-close" onclick="dashboard.hideReport()">&times;</button>
                </div>
                <div class="modal-body" id="reportContent">
                    <div style="margin-top: 20px;">
                        <button id="exportCsvBtn" class="btn btn-primary" style="width: 100%; margin-bottom: 10px;">ğŸ“‹ æ¥­å‹™è¨˜éŒ²ã‚’CSVä¿å­˜ (APKãƒ†ã‚¹ãƒˆ)</button>
                        <button id="clearJobsBtn" class="btn btn-danger" style="width: 100%;">ğŸ—‘ï¸ æœ¬æ—¥ã®ã‚¸ãƒ§ãƒ–ã‚’æ¶ˆå»</button>
                    </div>
                </div>
            </div>
        </div>

    </div>
    
    <footer style="text-align: center; padding: 10px; border-top: 1px solid #ccc; font-size: 12px; color: #888;">
        ğŸ­ APKä»®æƒ³ãƒ†ã‚¹ãƒˆç’°å¢ƒ - ãƒãƒ³ãƒ‰ãƒ«æ¸ˆã¿Capacitorãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    </footer>

    <!-- APKãƒ†ã‚¹ãƒˆç”¨ã®è¿½åŠ ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script>
        // APKãƒ†ã‚¹ãƒˆå°‚ç”¨é–¢æ•°
        function testCapacitorDetection() {
            console.log('ğŸ§ª Capacitoræ¤œå‡ºãƒ†ã‚¹ãƒˆé–‹å§‹');
            console.log('- Capacitorå­˜åœ¨:', typeof window.Capacitor !== 'undefined');
            console.log('- isNativePlatform:', window.Capacitor?.isNativePlatform?.());
            console.log('- Plugins:', Object.keys(window.Capacitor?.Plugins || {}));
            alert(`Capacitoræ¤œå‡ºçµæœ:\n- å­˜åœ¨: ${typeof window.Capacitor !== 'undefined'}\n- ãƒã‚¤ãƒ†ã‚£ãƒ–: ${window.Capacitor?.isNativePlatform?.()}\n- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³: ${Object.keys(window.Capacitor?.Plugins || {}).join(', ')}`);
        }

        function testDataSave() {
            console.log('ğŸ§ª ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãƒ†ã‚¹ãƒˆé–‹å§‹');
            if (window.dashboard) {
                dashboard.saveData();
                alert('ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãƒ†ã‚¹ãƒˆå®Œäº†\nã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„');
            } else {
                alert('DashboardæœªåˆæœŸåŒ–');
            }
        }

        function testBackupFunction() {
            console.log('ğŸ§ª ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆé–‹å§‹');
            if (window.dashboard) {
                dashboard.backupData();
            } else {
                alert('DashboardæœªåˆæœŸåŒ–');
            }
        }

        function testCsvExport() {
            console.log('ğŸ§ª CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ†ã‚¹ãƒˆé–‹å§‹');
            if (window.dashboard) {
                dashboard.exportDataAsCsv();
            } else {
                alert('DashboardæœªåˆæœŸåŒ–');
            }
        }

        function showStoredFiles() {
            console.log('ğŸ§ª ä¿å­˜ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª');
            const files = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('capacitor_file_')) {
                    const fileName = key.replace('capacitor_file_', '');
                    const size = localStorage.getItem(key).length;
                    files.push(`${fileName} (${size}æ–‡å­—)`);
                }
            }
            
            if (files.length === 0) {
                alert('ä¿å­˜ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚ã‚Šã¾ã›ã‚“');
            } else {
                alert(`ä¿å­˜ãƒ•ã‚¡ã‚¤ãƒ« (${files.length}å€‹):\n${files.join('\n')}`);
            }
            
            console.log('ğŸ“ ä¿å­˜ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§:', files);
        }

        function clearSimulationData() {
            if (confirm('ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
                const keys = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('capacitor_')) {
                        keys.push(key);
                    }
                }
                keys.forEach(key => localStorage.removeItem(key));
                alert(`${keys.length}å€‹ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ`);
                console.log('ğŸ—‘ï¸ ã‚¯ãƒªã‚¢ã—ãŸãƒ‡ãƒ¼ã‚¿:', keys);
            }
        }
    </script>

    <!-- å…ƒã®JavaScriptã‚’ãƒ­ãƒ¼ãƒ‰ -->
    <script src="script.js"></script>
</body>
</html>