# ラミオペ・ダッシュボード - 変更履歴

## Ver.2.6 (2025-08-13)

### 🐛 重要なバグ修正

#### Ver.2.6の2つの重大バグを修正
- **UI表示バグ**: ラジオボタンラベルテキストが白背景に白文字で表示され視認不可能だった問題を修正
- **計算ロジックバグ**: フィルムセッション残量表示で不正確な計算式を使用していた問題を修正

#### 🔧 技術的修正内容

**UI表示修正**:
```css
/* Ver.2.6: ラジオボタンラベルの視認性修正 */
.radio-option label {
    color: var(--text-color) !important;
    font-weight: 500;
    cursor: pointer;
    margin: 0;
}
```

**計算ロジック修正**:
- **renderJobList関数**: `session.filmRemaining` → `(session.filmCapacity - totalUsed)` に変更
- **getFilmShortageStatus関数**: フィルム不足判定でも正しい計算式 `容量(m) - 使用(m) = 残り(m)` を適用
- **根本原因**: 以前の実装では `session.filmRemaining` の値に依存していたが、これが不正確だった

#### 🎯 影響範囲
- **フィルムセッション残量表示**: 正確な残量が表示されるように修正
- **フィルム不足警告**: 正確な残量に基づく警告判定に修正
- **ジョブ入力フォーム**: ラジオボタンが視認可能になり操作性が向上

#### 🛠️ 技術的品質向上
- **一貫性**: 全てのフィルム計算で統一された計算式を使用
- **精度**: データの不整合に影響されない直接計算による高精度化
- **可視性**: UIコンポーネントの適切なコントラスト確保

---

## Ver.2.5 (2025-08-13)

### 🔧 フォーム統一とフィルム管理機能の拡張

#### 🐛 重要なバグ修正
- **ヘッダーボタン機能復旧**: Ver.2.4で発生したイベントリスナー競合を修正、設定ボタンとログページアクセスボタンが正常に動作
- **ジョブフォーム不具合修正**: Ver.2.0リファクタリング時に欠落したshowJobInputForm関数の完全再実装

#### ✨ 新機能
- **統一ジョブ入力システム**: 2タブ方式（生産枚数指定・部数計算）で一貫したフォーム設計を実現
- **フィルム初期容量設定UI**: 新規フィルム作成後、容量表示をクリックして初期容量を設定可能
- **フィルム不足警告システム**: 残量に基づく3段階の警告表示（残量少・残量わずか・フィルム切れ）

#### 🔄 改善
- **UI簡素化**: ジョブリストの不要なヘルパーテキストを削除、クリーンな表示を実現
- **フォーム仕様統一**: CommonJobForm仕様に基づく一貫した入力フィールド構成
- **視覚的フィードバック強化**: フィルム容量表示のクリック可能性を明示、ホバー効果追加

#### 🛠️ 技術的変更
- **JavaScript**: 
  - `addJobToNewFilmSession()`と`addJobToExistingSession()`関数の新規実装
  - `createJobData()`関数によるデータ検証・作成処理の分離
  - `showFilmCapacityInputUI()`と`getFilmShortageStatus()`関数の追加
  - イベントリスナー管理の改善（DOMContentLoaded内で一元管理）
- **HTML**: ヘッダーボタンのonclick属性を削除、JavaScript側で動的設定
- **CSS**: フィルム容量表示とフィルム不足警告用のスタイル追加

#### 📊 フィルム管理システム強化
- **容量表示の拡張**: 「残り: Xm (容量: Ym)」形式で詳細情報を表示
- **不足判定ロジック**: 比率ベース（10%, 20%）と絶対値ベース（2m, 5m）の複合判定
- **警告レベル**: 正常 → 残量少 → 残量わずか → フィルム切れの4段階

#### 🎯 UX向上
- **直感的操作**: フィルム容量をクリックするだけで設定変更可能
- **視覚的警告**: フィルム不足時のアニメーション効果とカラーコーディング
- **一貫性**: 全ジョブ入力フォームで統一されたUI/UXを提供

---

## Ver.2.4 (2025-08-13)

### 🔄 隠しログページ実装とUX改善アップデート

#### ✨ 新機能
- **隠しログページシステム**: ヘッダーの🎛️アイコンをクリックして、専用のログ閲覧ページへアクセス
- **洗練されたログ記録**: グローバル配列による効率的なログ管理（最新200件自動保持）
- **完全なページ切り替え**: メインダッシュボードとログページ間のシームレス切り替え
- **ログ管理機能**: ログクリア、リアルタイム更新、タイムスタンプ表示

#### 🔄 改善
- **非侵入的ログシステム**: 通常操作を妨げない隠しアクセス方式
- **UX向上**: ジョブ未登録時にアクションボタンを最初に表示して操作を促進
- **ログ表示の最適化**: レベル別カラーコーディング、タイムスタンプ、検索しやすいフォーマット

#### 🛠️ 技術的変更
- **完全リファクタリング**: Ver.1.9の固定デバッグコンソールを撤去
- **JavaScript**: 新しいログシステム (`window.appLogs`, `showLogPage()`, `showDashboard()`)
- **HTML**: 
  - デバッグコンソール要素とstyleタグを削除
  - 設定画面からデバッグチェックボックスを削除
  - ヘッダーアイコンにトリガー機能追加
- **CSS**: ログページ専用のスタイル追加（`.log-page-header`, `.log-container`, `.log-entry`等）
- **機能削除**: toggleDebugConsole関数とローカルストレージ管理を完全削除

#### 📊 アーキテクチャ変更
- **データ管理**: console出力を配列で一元管理、メモリ効率最適化
- **UI切り替え**: 単一ページアプリ (SPA) パターンの導入
- **イベント管理**: 動的要素のイベントリスナー適切な設定・削除

#### 🎯 UX最適化
- **直感的アクセス**: 隠しログ機能で開発者向け機能を綺麗に分離
- **操作性向上**: 空状態でのアクションボタン優先表示
- **保守性向上**: 古いデバッグシステムの技術的負債を完全解消

---

## Ver.2.1 (2025-08-13)

### 🔧 デバッグ機能とUI改善アップデート

#### ✨ 新機能
- **デバッグコンソール表示/非表示切り替え**: 設定メニューからデバッグコンソールの表示を制御可能
- **ローカルストレージ永続化**: デバッグコンソール表示設定をブラウザに記録し、次回起動時も設定を維持
- **設定メニューの実装**: 勤務時間設定とデバッグ設定を統合した設定モーダル

#### 🔄 改善
- **フィルムセッション表示順序**: 新しく作成したフィルムが常にリストの上部に表示（降順表示）
- **デバッグUX向上**: 普段はコンソールを非表示にして通常操作に集中、問題発生時のみ表示可能
- **設定画面デザイン**: チェックボックス、ヘルプテキスト、セクション分けによる見やすい設定UI

#### 🛠️ 技術的変更
- **HTML**: 設定モーダルにデバッグ設定セクションとチェックボックス追加
- **JavaScript**: 
  - デバッグコンソール表示制御関数: `window.toggleDebugConsole(visible)`
  - ローカルストレージキー: `laminator_debug_console_visible`
  - 設定管理関数: `showSettings()`, `saveSettings()`, `resetSettings()`
- **CSS**: チェックボックス、ヘルプテキスト、設定セクション用スタイル追加
- **デバッグシステムバージョンアップ**: Ver.1.9 → Ver.2.1

#### 📊 UX最適化
- **設定の永続化**: ユーザーの設定選択が次回起動時も保持される
- **直感的な操作**: 設定から簡単にデバッグ表示を切り替え
- **フィルム管理の改善**: 新しいフィルムが目立つ位置に表示されることで操作効率向上

---

## Ver.2.0 (2025-08-13)

### 🔄 大規模リファクタリング - インラインジョブ追加システムの実装

#### 🗂️ アーキテクチャ変更
- **複雑なジョブ準備システム完全削除**: 「ジョブを準備」機能を削除し、直感的なインライン追加システムに統一
- **HTML構造簡素化**: 複雑なフォーム要素（54-126行）を削除、よりクリーンなHTML構造を実現
- **JavaScript設計再構築**: 準備ベースのロジック（`this.preparedJob`, `prepareJob()`, `addPreparedJobToSession()`, `addPreparedJobToNewFilm()`）を完全削除

#### ✨ 新機能
- **インラインジョブ追加フォーム**: ボタンクリックで該当箇所に動的フォーム表示
- **各フィルムブロック専用ボタン**: 「+ このフィルムにジョブを追加」ボタンを各フィルムセッションに常時配置
- **新フィルム開始ボタン**: 「+ 新しいフィルムでジョブを開始」ボタンをリスト末尾に常時配置
- **動的フォーム生成**: ユニークID付きフォーム、入力モード切り替え、バリデーション機能内蔵

#### 🎨 UX大幅改善
- **ワンクリック操作**: 準備→選択の2段階プロセスを1段階に簡素化
- **視覚的フィードバック**: アニメーション付きインラインフォーム表示
- **直感的配置**: 追加したい場所にフォームが直接表示される自然なUX
- **エラー処理強化**: フォーム入力バリデーションとエラーメッセージ表示

#### 🛠️ 技術的実装
- **新JavaScript関数**:
  - `showJobInputForm(targetElement, sessionId)`: 動的インラインフォーム表示
  - `handleSaveJob(formId, sessionId)`: フォームデータ処理・保存
  - `addJobToExistingSession(sessionId, jobData)`: 既存セッションへのジョブ追加
  - `addJobToNewFilmSession(jobData)`: 新規セッション作成・ジョブ追加
- **CSS拡張**: インラインフォーム専用スタイル（`.inline-job-form`, `.job-form-container`, `.form-actions`）
- **動的DOM操作**: `insertAdjacentHTML`による効率的フォーム挿入
- **イベントリスナー管理**: 動的生成要素のイベント処理

#### 📊 コード品質向上
- **コード量削減**: 複雑な条件分岐と状態管理を大幅削減
- **保守性向上**: 単一責任原則に基づく関数分割
- **エラーハンドリング**: try-catch構文による堅牢なエラー処理
- **デバッグ情報削除**: 不要な`console.log`の整理

---

## Ver.1.9 (2025-08-13)

### 🔍 永続デバッグコンソール実装

#### 新機能
- **永続デバッグコンソール**: アプリケーション画面下部に固定表示されるデバッグエリア
- **JavaScriptエラー捕捉**: 未処理エラーとPromise Rejectionを自動的に表示
- **コンソール出力統合**: すべてのconsole.log/error/warnを画面に表示

#### 技術実装
- **HTML**: 画面下部25%にスクロール可能なデバッグコンソールエリアを追加
- **JavaScript**: console.log等をオーバーライドして画面出力に統合
- **エラーハンドリング**: window.onerror と onunhandledrejection でエラー捕捉

#### 目的
- ブラウザの開発者ツールに依存しない独立したデバッグ環境の提供
- 「ジョブを準備」後のボタン表示問題の根本原因特定

---

## Ver.1.8 (2025-08-13)

### 🐞 デバッグ機能追加

#### 追加されたデバッグログ
- **prepareJob関数**: `this.preparedJob`変数にデータ設定直後の状態をコンソール出力
- **renderJobList関数**: UI描画開始時の`this.preparedJob`変数の状態をコンソール出力

#### 目的
- 「ジョブを準備」後に追加ボタンが表示されない問題の根本原因を特定
- `this.preparedJob`変数の状態変化をリアルタイムで追跡可能

#### 🛠️ 技術的変更
- `console.log('--- prepareJob executed ---', this.preparedJob);` を154行目の直後に追加
- `console.log('--- renderJobList started ---', this.preparedJob);` を403行目の関数開始時に追加

---

## Ver.1.7 (2025-08-13)

### 🐛 表示バグ修正

#### バグ修正
- **ジョブリストコンテナの表示問題修正**: 「ジョブを準備」後に表示される新しいボタンが見えない問題を解決
- **コンテナ表示強制**: 準備されたジョブがある場合に `display: block` と `minHeight: 100px` を設定して確実に表示

#### 🛠️ 技術的変更
- `renderJobList()`関数内で条件分岐時にコンテナスタイルを動的設定
- 各フィルムブロックとリスト末尾の新フィルム用ボタン両方に対応

---

## Ver.1.6 (2025-08-13)

### 🔧 データ精度向上とUX大幅改善

#### 🐛 バグ修正
- **親ブロック使用メーター数の計算精度修正**: フィルムセッションの「使用(m)」が全ジョブの総使用メーター数の正確な合計値を表示

#### 🔄 UX大幅改善 - ジョブ追加プロセスのリファクタリング
- **ジョブ準備システム導入**: 「ジョブを準備」で事前にジョブデータを作成、追加先は後で選択
- **明確な追加先選択**: 各フィルムブロックに「+ このフィルムにジョブを追加」ボタンを設置
- **新フィルム作成の改善**: ジョブリスト末尾に「+ 新しいフィルムでジョブを開始」ボタンを配置
- **追加先の曖昧性解消**: ユーザーが明確に追加先を選択できるUI設計

#### ✨ 新機能
- **フィルム残量の双方向調整**: 正数で追加、負数で減算が可能な調整機能
- **データ入力ミス修正**: フィルム残量の過剰入力などの修正が容易

#### 🛠️ 技術的変更
- `renderJobList()`関数で親ブロック使用量の計算ロジック修正
- `preparedJob`プロパティによる準備されたジョブの状態管理
- `prepareJob()`, `addPreparedJobToSession()`, `addPreparedJobToNewFilm()`関数の新規実装
- `addFilmRemaining()`関数で負の数値入力対応と双方向調整機能
- 新規CSSクラス: `.film-add-btn`, `.new-film-button-container`, `.new-film-btn`

---

## Ver.1.5 (2025-08-13)

### 📊 ジョブ情報表示の拡張

#### ✨ 新機能
- **総使用メーター数表示**: ジョブリストで各ジョブの総フィルム使用量が一目で確認可能

#### 🔄 改善
- **ジョブ詳細フォーマット拡張**: 「生産枚数 / 1枚あたりの使用長 / 生産時間 / 総使用メーター数」の4項目表示
- **リソース管理の可視化**: フィルム消費量の把握が容易になりコスト管理が向上

#### 🛠️ 技術的変更
- `renderJobList()`関数のジョブ詳細表示部分を更新
- 総使用メーター数は「生産枚数 × 1枚あたりの使用長」の計算で表示
- 表示例: `1100枚 / 0.54m / 15.0分 / 594.0m`

---

## Ver.1.4 (2025-08-13)

### 🔧 状態管理ロジックの強化とUI改善

#### ✨ 新機能
- **親子関係状態管理システム**: フィルムブロック（親）の状態がジョブ（子）の状態に基づいて自動更新
- **強化されたセッション状態管理**: `updateSessionStatuses()`および`getSessionStatus()`関数により正確な状態表示

#### 🔄 改善
- **完了/未完了ボタンの修正**: 状態切り替えが確実に動作し、親ブロックの状態も即座に連動更新
- **削除ボタン色の調整**: 鮮やかな赤色（#E74C3C）からソフトな赤色（#E57373）に変更し、視覚的刺激を軽減
- **エラーハンドリング強化**: ジョブ完了/未完了操作時のコンソール出力による詳細なデバッグ情報

#### 🛠️ 技術的変更
- `renderJobList()`関数で`updateSessionStatuses()`を自動実行
- `completeJob()`と`uncompleteJob()`関数に状態管理呼び出し追加
- 親フィルムブロックの状態ロジック：全ジョブ完了時は「完了」、一つでも未完了があれば「進行中」
- CSS変更: `.job-delete-btn`の背景色を`#E57373`に変更

---

## Ver.1.3 (2025-08-12)

### 🎯 UI/UX大幅改善アップデート

#### ✨ 新機能
- **ジョブタップでフィルム残量追加**: ジョブアイテムをタップして、そのジョブ用のフィルム残量を追加可能
- **完了/未完了双方向切り替え**: 完了したジョブを「未完了に戻す」ことが可能（Undo機能）

#### 🔄 改善
- **フィルムリスト表示順序**: 新しいフィルムが一番上に表示されるよう変更（降順表示）
- **ジョブアイテムレイアウト**: 削除ボタンを左端、完了ボタンを右端に配置し誤操作を防止
- **ホバー効果**: ジョブアイテムにマウスホバー時の視覚的フィードバック追加

#### 🛠️ 技術的変更
- `renderJobList()`関数で非破壊的配列逆順表示実装
- `uncompleteJob()`関数追加
- `addFilmRemaining()`関数追加
- CSS新クラス追加: `.job-actions-left`, `.job-actions-right`, `.job-uncomplete-btn`, `.job-delete-btn`
- イベントバブリング制御: `event.stopPropagation()`実装

---

## Ver.1.2 (2025-08-12)

### 🔧 フィルム管理機能追加

#### ✨ 新機能
- **フィルム初期残量入力**: ジョブ追加時に手動でフィルム初期残量を指定可能

#### 🛠️ 技術的変更
- `getJobInputData()`関数に`initialFilmRemaining`パラメータ追加
- `addJobToCurrentFilm()`と`addJobToNewFilm()`で初期残量の適用ロジック実装
- HTMLフォームに「フィルム初期残量(m)」入力フィールド追加

---

## Ver.1.1 (2025-08-12)

### 🎯 包括的UI/UX改善アップデート

#### ✨ 新機能
- **ユーザー設定システム**: 勤務時間、休憩時間、片付け時間等の包括的設定機能
- **3カラム時間表示**: 開始時刻、最終終了予定、本日の目標を横並び表示

#### 🔄 改善
- **ジョブリスト表示順序**: 新しいジョブが上部に表示（最新優先）
- **完了ボタン機能強化**: 確定終了時刻記録、実時間考慮の終了時刻再計算
- **削除ボタン配置**: 右端から左端に変更し誤操作防止

#### 🛠️ 技術的変更
- フィルム残量管理をセッション固有に変更（グローバル→ローカル）
- `recalculateFinishTime()`関数実装
- 設定モーダルUI実装
- `timeSettings`オブジェクト拡張

#### ❌ 削除機能
- フィルム残量電卓機能の完全削除（シンプル化のため）

---

## Ver.3.0 (2025-08-12)

### 🚀 統合ダッシュボード仕様への完全刷新

#### ✨ 新機能
- **フィルムセッション管理システム**: ジョブをフィルム単位でグループ化
- **リアルタイム終了時刻計算**: 全ジョブ・追加時間を考慮した動的計算
- **統合ダッシュボードUI**: タブ型から単一画面型への根本的変更

#### 🔄 改善
- **モバイルファースト設計**: 360px〜480px幅での最適化
- **PWA完全対応**: Service Worker + Cache APIによるオフライン動作
- **データ永続化**: localStorage 'laminator_dashboard_v3'による状態保存

#### 🛠️ 技術的変更
- フィルムセッション管理クラス実装
- 28項目包括的テストスイート作成（87.5%成功率）
- カスタムプロパティ基盤のデザインシステム
- アクセシビリティ対応（フォーカス・ARIA）

---

## 開発統計

- **開発期間**: 2025年8月12日（1日集中開発）
- **総バージョン数**: 4バージョン（Ver.3.0 → Ver.1.1 → Ver.1.2 → Ver.1.3）
- **技術スタック**: Vanilla JavaScript, CSS Custom Properties, PWA
- **テストカバレッジ**: 87.5%（核心機能検証）
- **対応デバイス**: モバイル最適化（Android, iOS対応）

## 技術的特徴

### 核心計算ロジック
1. **実生産枚数**: `Math.ceil(copies / pages) + extraSheets`
2. **使用長**: `(paperLength - overlapWidth) / 1000` (mm→m)
3. **加工時間**: `sheets × usageLength / processSpeed` (分)
4. **終了時刻**: `workStartTime + totalProcessingTime + extraTime + cleanupTime`

### データ構造
```javascript
// フィルムセッション
{
  id, startTime, endTime, jobs, status,
  filmCapacity, filmRemaining, filmUsed
}

// ジョブデータ
{
  id, timestamp, sheets, paperLength, overlapWidth,
  processSpeed, usageLength, processingTime,
  inputMode, completed, completedAt, initialFilmRemaining
}
```

### PWA機能
- Service Worker によるオフラインキャッシュ
- manifest.json によるインストール対応
- localStorage による完全ローカル動作
- 日次自動データリセット（設定は引き継ぎ）