# ãƒ©ãƒŸã‚ªãƒšãƒ»ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»æ¥­å‹™è¨˜éŒ²ä¿å­˜å•é¡Œã®ç›¸è«‡è³‡æ–™

## ç¾çŠ¶ã®å•é¡Œ
- ğŸ“¤ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚ä½•ã‚‚èµ·ã“ã‚‰ãªã„
- ğŸ“‹ æ¥­å‹™è¨˜éŒ²CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚ä½•ã‚‚èµ·ã“ã‚‰ãªã„
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚è¡¨ç¤ºã•ã‚Œãªã„
- ä»–ã®æ©Ÿèƒ½ï¼ˆæ™‚é–“è¨ˆç®—ã€ã‚¸ãƒ§ãƒ–ç®¡ç†ãªã©ï¼‰ã¯å®Œç’§ã«å‹•ä½œã—ã¦ã„ã‚‹

## æ±‚ã‚ã‚‹ã“ã¨
- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã«JSONãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã“ã¨
- æ¥­å‹™è¨˜éŒ²CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã«CSVãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã“ã¨
- Android APKç’°å¢ƒã¨Webãƒ–ãƒ©ã‚¦ã‚¶ä¸¡æ–¹ã§å‹•ä½œã™ã‚‹ã“ã¨

## æŠ€è¡“ç’°å¢ƒ
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Capacitor 7 (HTML/JavaScript/CSS)
- **ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ**: Android APK + Web PWA
- **ãƒ‡ãƒ¼ã‚¿ä¿å­˜**: Capacitor Preferences API + localStorage ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
- **ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ **: Capacitor Filesystem APIä½¿ç”¨æƒ³å®š

## ç¾åœ¨ã®HTMLãƒœã‚¿ãƒ³è¨­å®š

```html
<!-- è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒœã‚¿ãƒ³ -->
<button class="btn btn-primary" id="backup-data-btn" onclick="dashboard.backupData()">ğŸ“¤ é€²æ—ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</button>
<button class="btn btn-secondary" id="restore-data-btn" onclick="dashboard.triggerRestore()">ğŸ“¥ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ</button>
<input type="file" id="restore-file-input" accept=".json" style="display: none;" onchange="dashboard.restoreData(event)">

<!-- ãƒ¬ãƒãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã®CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³ -->
<button id="exportCsvBtn" class="btn btn-primary" style="width: 100%; margin-bottom: 10px;">ğŸ“‹ æ¥­å‹™è¨˜éŒ²ã‚’CSVä¿å­˜</button>
```

## ç¾åœ¨ã®JavaScriptã‚³ãƒ¼ãƒ‰ï¼ˆå•é¡Œã®ã‚ã‚‹éƒ¨åˆ†ï¼‰

### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ©Ÿèƒ½ã®ã‚³ãƒ¼ãƒ‰
```javascript
// ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ä½œæˆãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ (Capacitor Filesystemå¯¾å¿œç‰ˆ)
async backupData() {
    try {
        console.log('ğŸ”„ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ä½œæˆé–‹å§‹...');
        const dataKey = 'laminator_dashboard_v3';
        let data;
        
        if (isCapacitorEnvironment && CapacitorPreferences) {
            // APKç’°å¢ƒ: Capacitor Preferencesä½¿ç”¨
            console.log('ğŸ”„ Capacitor Preferencesã‹ã‚‰ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿å–å¾—...');
            const result = await CapacitorPreferences.get({ key: dataKey });
            data = result.value;
        } else {
            // Webç’°å¢ƒ: localStorageä½¿ç”¨
            console.log('ğŸ”„ localStorageã‹ã‚‰ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿å–å¾—...');
            data = localStorage.getItem(dataKey);
        }
        
        if (!data) {
            this.showToast('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', 'warning');
            return;
        }

        const today = new Date();
        const dateStr = today.getFullYear() + '-' + 
            String(today.getMonth() + 1).padStart(2, '0') + '-' + 
            String(today.getDate()).padStart(2, '0');
        const filename = `lami-ope-backup-${dateStr}.json`;

        if (isCapacitorEnvironment && CapacitorFilesystem) {
            // APKç’°å¢ƒ: Capacitor Filesystem APIä½¿ç”¨
            try {
                console.log('ğŸ”„ Capacitor Filesystem APIã§ãƒ•ã‚¡ã‚¤ãƒ«æ›¸ãè¾¼ã¿...');
                
                await CapacitorFilesystem.writeFile({
                    path: filename,
                    data: data,
                    directory: 'DOCUMENTS', // Directory.Documents ã®æ–‡å­—åˆ—å®šæ•°
                    encoding: 'utf8' // Encoding.UTF8 ã®æ–‡å­—åˆ—å®šæ•°
                });
                
                console.log('âœ… Capacitor Filesystemã§ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¿å­˜æˆåŠŸ');
                this.showToast(`ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Documents/${filename}ã«ä¿å­˜ã—ã¾ã—ãŸ`, 'success');
                
            } catch (fsError) {
                console.warn('âŒ Filesystemä¿å­˜å¤±æ•—ã€blobä¿å­˜ã«fallback:', fsError);
                this.fallbackBlobDownload(data, filename);
            }
        } else {
            // Webç’°å¢ƒã¾ãŸã¯fallback: blobä¿å­˜
            console.log('ğŸ”„ Webãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã§blobä¿å­˜å®Ÿè¡Œ...');
            this.fallbackBlobDownload(data, filename);
        }
    } catch (error) {
        console.error('âŒ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼:', error);
        this.showToast('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
    }
}

// Fallback: Blob ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
fallbackBlobDownload(data, filename) {
    const blob = new Blob([data], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    a.style.display = 'none';
    document.body.appendChild(a);
    
    setTimeout(() => {
        a.click();
        setTimeout(() => {
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }, 100);
    }, 100);
    
    this.showToast('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ', 'success');
}
```

### å¾©å…ƒæ©Ÿèƒ½ã®ã‚³ãƒ¼ãƒ‰
```javascript
// å¾©å…ƒãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚’ãƒˆãƒªã‚¬ãƒ¼
triggerRestore() {
    const fileInput = document.getElementById('restore-file-input');
    fileInput.click();
}

// ãƒ‡ãƒ¼ã‚¿å¾©å…ƒæ©Ÿèƒ½ (Capacitor Preferenceså¯¾å¿œç‰ˆ)
async restoreData(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = async (e) => {
        try {
            const data = e.target.result;
            JSON.parse(data); // æœ‰åŠ¹ãªJSONã‹ãƒã‚§ãƒƒã‚¯
            const dataKey = 'laminator_dashboard_v3';
            
            if (isCapacitorEnvironment && CapacitorPreferences) {
                // APKç’°å¢ƒ: Capacitor Preferencesä½¿ç”¨
                console.log('ğŸ”„ Capacitor Preferencesã«å¾©å…ƒãƒ‡ãƒ¼ã‚¿ä¿å­˜...');
                
                await CapacitorPreferences.set({
                    key: dataKey,
                    value: data
                });
                
                console.log('âœ… Capacitor Preferencesã«å¾©å…ƒå®Œäº†');
            } else {
                // Webç’°å¢ƒ: localStorageä½¿ç”¨
                console.log('ğŸ”„ localStorageã«å¾©å…ƒãƒ‡ãƒ¼ã‚¿ä¿å­˜...');
                localStorage.setItem(dataKey, data);
                console.log('âœ… localStorageã«å¾©å…ƒå®Œäº†');
            }
            
            this.showToast('å¾©å…ƒãŒå®Œäº†ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã—ã¾ã™ã€‚', 'success');
            setTimeout(() => {
                location.reload();
            }, 1500);
        } catch (error) {
            console.error('å¾©å…ƒã‚¨ãƒ©ãƒ¼:', error);
            this.showToast('ç„¡åŠ¹ãªãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™', 'error');
        }
    };
    
    reader.readAsText(file);
    
    // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆåŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚‚å†é¸æŠå¯èƒ½ã«ã™ã‚‹ï¼‰
    event.target.value = '';
}
```

## ç¾åœ¨ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–
```javascript
// ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–
let dashboard;

document.addEventListener('DOMContentLoaded', async () => {
    dashboard = new LaminatorDashboard();
    window.dashboard = dashboard;  // HTMLã‹ã‚‰å‘¼ã³å‡ºã—å¯èƒ½ã«ã™ã‚‹
    
    // ãƒ˜ãƒƒãƒ€ãƒ¼ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šï¼ˆVer.2.5 ãƒã‚°ä¿®æ­£ï¼‰
    const logTrigger = document.getElementById('log-page-trigger-icon');
    if (logTrigger) {
        logTrigger.addEventListener('click', showLogPage);
        console.log('Log page trigger event listener added');
    }
    
    // è¨­å®šãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚‚å¿µã®ãŸã‚ç›´æ¥è¨­å®š
    const settingsBtn = document.querySelector('.header-btn');
    if (settingsBtn && dashboard) {
        settingsBtn.addEventListener('click', (e) => {
            e.preventDefault();
            dashboard.showSettings();
        });
        console.log('Settings button event listener added');
    }
});
```

## Capacitorè¨­å®š
```javascript
// Capacitor ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨­å®š
let CapacitorPreferences, CapacitorFilesystem;
let isCapacitorEnvironment = false;

// Capacitorç’°å¢ƒåˆ¤å®šã¨ãƒ—ãƒ©ã‚°ã‚¤ãƒ³åˆæœŸåŒ–
async function initializeCapacitor() {
    console.log('ğŸ”„ Capacitorç’°å¢ƒåˆ¤å®šã‚’é–‹å§‹...');
    console.log('ğŸ” ç’°å¢ƒæƒ…å ±:', {
        userAgent: navigator.userAgent,
        platform: navigator.platform,
        hasCapacitor: typeof window.Capacitor !== 'undefined',
        isNativePlatform: window.Capacitor ? window.Capacitor.isNativePlatform : false,
        isAndroid: /Android/.test(navigator.userAgent),
        locationProtocol: window.location.protocol
    });
    
    try {
        // Capacitoræœ¬ä½“ã®å­˜åœ¨ç¢ºèªã¨è©³ç´°åˆ¤å®š
        if (typeof window.Capacitor !== 'undefined') {
            console.log('âœ… Capacitorã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ¤œå‡º');
            
            // ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¤å®šï¼ˆè¤‡æ•°ã®æ–¹æ³•ã§ç¢ºèªï¼‰
            const isNative = window.Capacitor.isNativePlatform || 
                            window.Capacitor.isNative || 
                            window.location.protocol === 'capacitor:' ||
                            /Android/.test(navigator.userAgent);
            
            if (isNative) {
                console.log('âœ… ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ç’°å¢ƒã‚’æ¤œå‡º');
                isCapacitorEnvironment = true;
                
                // å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’èª­ã¿è¾¼ã¿
                try {
                    console.log('ğŸ”„ Capacitorãƒ—ãƒ©ã‚°ã‚¤ãƒ³èª­ã¿è¾¼ã¿é–‹å§‹...');
                    
                    const { Preferences } = await import('https://unpkg.com/@capacitor/preferences@7/dist/esm/index.js');
                    const { Filesystem, Directory, Encoding } = await import('https://unpkg.com/@capacitor/filesystem@7/dist/esm/index.js');
                    
                    CapacitorPreferences = Preferences;
                    CapacitorFilesystem = Filesystem;
                    
                    console.log('âœ… Capacitor Preferences & Filesystem ãƒ—ãƒ©ã‚°ã‚¤ãƒ³åˆæœŸåŒ–æˆåŠŸ');
                    
                } catch (pluginError) {
                    console.error('âŒ Capacitorãƒ—ãƒ©ã‚°ã‚¤ãƒ³èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', pluginError);
                    isCapacitorEnvironment = false;
                }
            }
        }
    } catch (error) {
        console.error('âŒ CapacitoråˆæœŸåŒ–ä¸­ã®äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼:', error);
        isCapacitorEnvironment = false;
    }
    
    console.log(`ğŸ“± æœ€çµ‚åˆ¤å®š: ${isCapacitorEnvironment ? 'Capacitor APKç’°å¢ƒ' : 'Webç’°å¢ƒ'}`);
}
```

## ç–‘å•ç‚¹ãƒ»èª¿æŸ»ã—ã¦ã»ã—ã„ã“ã¨

1. **HTMLãƒœã‚¿ãƒ³ã¨JavaScripté–¢æ•°ã®é€£æº**: `onclick="dashboard.backupData()"` ãŒæ­£ã—ãå‹•ä½œã—ã¦ã„ã‚‹ã‹ï¼Ÿ
2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ãªãœã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚è¡¨ç¤ºã•ã‚Œãªã„ã®ã‹ï¼Ÿ
3. **Capacitor Filesystem API**: Androidç’°å¢ƒã§ã®æ­£ã—ã„ä½¿ç”¨æ–¹æ³•ã¯ï¼Ÿ
4. **Blob ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**: Webç’°å¢ƒã§ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ–¹æ³•ã«å•é¡Œã¯ãªã„ã‹ï¼Ÿ
5. **CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ**: `id="exportCsvBtn"` ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å•é¡Œ

## å‹•ä½œç’°å¢ƒ
- **é–‹ç™º**: Termux (Android)
- **ãƒ†ã‚¹ãƒˆ**: Androidã®WebView (APK)ã€Chrome/Firefox (Web)
- **ãƒ“ãƒ«ãƒ‰**: GitHub Actions + Capacitor 7

## è¿½åŠ æƒ…å ±
- ä»–ã®æ©Ÿèƒ½ï¼ˆæ™‚é–“è¨ˆç®—ã€ãƒ•ã‚£ãƒ«ãƒ ç®¡ç†ã€è¨­å®šä¿å­˜ãªã©ï¼‰ã¯å…¨ã¦æ­£å¸¸å‹•ä½œ
- ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ãƒ»è¡¨ç¤ºã¯æ­£å¸¸
- åŒã˜é–‹ç™ºè€…ã®ä»–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆRecipeBoxï¼‰ã§ã¯åŒæ§˜ã®å®Ÿè£…ã§æˆåŠŸã—ã¦ã„ã‚‹

ã“ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã®å…·ä½“çš„ãªã‚³ãƒ¼ãƒ‰ä¿®æ­£æ¡ˆã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚ç‰¹ã«ã€CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šæ–¹æ³•ã¨ã€Androidç’°å¢ƒã§ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å®Ÿè£…ã®æ”¹å–„æ–¹æ³•ã«ã¤ã„ã¦çŸ¥ã‚ŠãŸã„ã§ã™ã€‚